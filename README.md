# アプリケーション名： 模擬案件中級_勤怠管理アプリ
# 環境構築
Dockerビルド
<br>
<br>
　1\. 　git cloneリンク（ターミナルコマンド） git clone https://github.com/takayuki2025/simulation2_1.git  の実行
<br>
　2\. （ターミナルコマンド）cd simulation2_1　の実行。
<br>
　3\. Docker Desktopを立ち上げて（ターミナルコマンド）docker-compose up -d --build　の実行
<br>
<br>
<br>
laravel環境構築
<br>
<br>
　1\. （ターミナルコマンド）docker-compose exec php bash　の実行
<br>
　2\. （PHPコンテナー）composer install　の実行
<br>
　3\.  (PHPコンテナー)  cp .env.example .env　の実行　後.envの環境変数の変更(今回は開発用を事前に.env.exampleにAPP_KEY以外は写しておきました。)
<br>
　4\. アプリケーションキーの作成<br>
　　（PHPコンテナー）php artisan key:generate　の実行
<br>
　5\. マイグレーションの実行<br>
　　php artisan migrate　の実行
<br>
　6\. シーディングの実行<br>
　　php artisan db:seed　の実行
<br>
　7\. テスト用のデーターベース作成からPHPUnitテスト実行まで。<br>
　（exitでターミナルに戻ってから）docker-compose exec mysql bash　を実行<br>
　（mysqlコンテナー）mysql -u root -p   の実行後パスワード　root　と入力して実行<br>
　（mysql接続後）CREATE DATABASE coachtech2_test;　を実行 (実行後exitコマンドでターミナルまで戻る)<br>
　（ターミナルで　docker-compose exec php bash を実行した後のPHPコンテナーで）<br>
　(PHPコンテナー) vendor/bin/phpunit　を実行してテストをしてください。
<br>
<br>
<br>

# 伝えること<br>
- ユーザー情報（管理者・一般ユーザ）、勤怠記録情報のダミーデーターを作成致しました。(専属コーチと相談して管理者1人、一般ユーザー4人分、勤怠記録62日分作成致しました。)<br>
　ユーザー情報一覧です。'　'は削除してください。　roleは管理者と一般ユーザーを分けるためのカラムです。<br>
　　１　名前：'川田　隆之'、メールアドレス：'t.principle.k2024@gmail.com'、パスワード：'takayuki'、role：'admin'（管理者）、<br>
　　２　名前：'山田　太郎'、メールアドレス：'taro.y@coachtech.com'、パスワード：'testtest1'、role：'employee'（一般ユーザー）日勤専用、<br>
　　３　名前：'西　怜奈'、メールアドレス：'reina.n@coachtech.com'、パスワード：'testtest2'、role：'employee'（一般ユーザー）、日勤専用<br>
　　４　名前：'秋田　朋美'、メールアドレス：'tomomi.a@coachtech.com'、パスワード：'testtest3'、role：'employee'（一般ユーザー）、夜勤専用<br>
　　５　名前：'中西　教夫'、メールアドレス：'norio.n@coachtech.com'、パスワード：'testtest4'、role：'employee'（一般ユーザー）、２交代制<br>
　勤怠記録情報はランダムで生成されます。(週休2日制(土日休み)シーダー実行当日より前の62日分、<br>
　日勤専用(定時9時〜18時),夜勤専用(定時21時〜6時),２交代制(日勤,夜勤を1週間ごと)として<br>
　修正申請等を入れやすいように平日7％の確率でユーザーごとに出勤なし、休憩一般的な1日3回(残業時4回)、<br>
　残業30%の確率としてシーダーファイルを作成致しました。)<br><br>

- 専属コーチに承認を得ましたことで、テーブル内のカラムごとのスペースが少しfigmaと違いますが、<br>
文字数(名前・メール・備考)が多い場合の対策を優先を致しまして、<br>
　管理者専用ページの日ごとの勤怠一覧、スタッフ一覧の名前の文字数は10文字まで(申請一覧では名前8文字まで)、メールアドレス(ドメイン含む)は40文字まで、<br>
　申請一覧(一般ユーザー専用ページも同じ)の備考は9文字までは全て1行で表示できるようにして、名前・備考はそれ以降の文字数の場合は... と表示をして、<br>
　ここにしか表示されないメールアドレスの場合は...ではなく2行目以降に折り返すように致しました。<br>
　(名前は次ページの勤怠詳細ページ、スタッフごとの月単位勤怠ページでスペースが取れるのでそこで全て表示されるように折り返しています。)<br>
　(備考も申請一覧ページの次ページの申請承認ページで全て表示されるようにテーブルのスペース内で折り返しています。)<br><br>

- 専属コーチに承認を得ましたことで、ログイン時のフォームリクエストは基本LoginRequest.phpでバリデーションを設定して、データーベースへの確認が必要なバリデーションは、Auth/LoginControllerで実装するように致しました。<br><br>

- (一般ユーザー・管理者)それぞれ所定のログインページ以外からログインを試みた時にusersテーブルに登録情報がある場合でも、セキュリティー管理のため一律、登録情報がない場合と同じ'ログイン情報が登録されていません。'と表示されるように設定致しました。<br><br>

- (一般ユーザー・管理者)ともに修正申請、修正の詳細ページで休憩開始と休憩終了のワンセット１回分,出勤履歴がある場合は既存の休憩回数に1回分追加、出勤履歴がない場合は1回分の空の入力フォームを挿入しています。<br><br>

- (一般ユーザー・管理者)ともに未来の日付は修正申請、修正はできないように詳細ボタンの表示をしないようにしました。<br><br>

- (一般ユーザー)からの修正申請は同じ日は２度修正できないように致しました。<br>
　(一般ユーザー用勤怠詳細ページで修正申請後、承認待ち：＊承認待ちのため修正はできません。<br>
　/承認済み：＊この日は一度承認されたので修正できません。<br>
　/修正申請なし：修正ボタン設置。のようにメッセージ内容や送信処理ボタンの設置を状態によって分けています。)<br><br>

- (一般ユーザー)の修正申請後は今月の勤怠一覧に戻るようにして申請完了が分かりやすいように上部にセッションメッセージを追加しました。<br><br>

- (管理者)ページからのCSV機能はスタッフ毎の月次勤務一覧情報と次につながる給料システム連携のために、所定労働時間(分)、残業時間(分)、申請/修正理由を追加して、一番下の欄に、総計、(月)出勤数を追加しました。<br><br>

- シフト勤務(日勤・夜勤)にも対応できるように修正申請、修正機能も日跨ぎ対応に致しました。<br>
しかしジョブカン勤怠管理のような一般的な勤怠管理のように,基本契約出社時間より早く出社した場合でも契約出社時間を元に労働時間を計算するということはしていなく,<br>
出社時間を元に労働時間を計算していたり、夜間帯(22時〜5時)の労働は深夜時間労働として別に計算していません。
　もしその機能が必要なら実装できるようにします。<br><br>





<br>

# スプレットシートの基本設計書にある項目で追加した内容（模擬案件の時だけ掲載）<br><br>
- 画面関係のRoute,Controller<br>
　プロジェクト内のコントローラーは３つで<br>
　・Auth/LoginController：一般ユーザー・管理者ログイン処理<br>
　・UserAttendantManagerController：一般ユーザー処理<br>
　・AdminAttendantManagerController：管理者処理　の３つです。<br><br>

- Viewファイル<br>

- バリデーション関係<br>
　専属コーチに承認を得ましたことで、バリデーションメッセージはテストケース一覧ではなく機能要件と一致するように致しました。<br>
　勤怠修正のバリデーションルールとして機能要件にはなかった、<br>
出勤時間等にH:i または HH:ii の形式。の追加。休憩開始と休憩終了の片側のみ入力時バリデーションメッセージ(両方空欄(出勤したが休憩なし)はOK)の追加、<br>
　出勤時間・退勤時間・休憩開始時間・休憩終了時間のそれぞれの時間が、その項目の後に設定、前に設定する必要があることに関して不適切な設定にならないように、<br>
それから日跨ぎ勤務対応として出勤後、退勤時間が18時間以内なら日跨ぎ勤務として機能するように、<br>
ApplicationAndAttendantRequest.phpにwithValidator(追加検証)も追加して実装致しました。<br>

<br>
<br>

# 今後開発品質の高い効率の良いWEB開発をしていく上でのまとめ（模擬案件の時だけ掲載）<br>
   - 今回は主に時間の表示,計算(複数回),保存,時間を使っての考え方,応用の仕方等学ばせていただきました。<br>
   　勤怠管理アプリはとても人気があるジョブカン勤怠管理が代表的ですが,ジョブカン勤怠管理は機能も充実していて評判も良かったり,セキュリティー対策も良かったり,連携も充実(給料計算、経費精算等)している上,コスト面でも１従業員300円あたりとサービスが良い分野のある開発の経験をさせていただき,次につながる技術の応用やアイデアをいろいろ出せるように学んで行けるようにと思っています。<br>
   - もくもく会でお話を聞くことができたのですがpro生の,姫野太雅さん,亀山裕樹さん(Java),一倉さやかさん(Ruby),ozaponさんなどのお話で,Laravel以外の案件の開発も携わっているということを聞き,他の言語(JavaやRubyもしくはPython)などの案件に私も携わることができたらと,JavaScript(Nuxt.js,React等)を学習しながらですが,模擬案件2つ目終了した後に私も未来を見据えて仕事で良く活かせるように進めてみようと思っています。
<br>

# ER図<br>
<img width="1920" height="1080" alt="Image" src="https://github.com/user-attachments/assets/7f31046d-aea5-4fc7-b934-37f04743c92b" />
<br>

# 使用技術<br>
  - PHP 8.4.12
  - Laravel 12.30.1 (fortify 1.30)
  - MySql 8.4.6
  - nginx 1.28.0
<br>

# URL<br>
  - ユーザー登録： http://localhost/register/
  - 一般ユーザー用ログイン： http://localhost/login
  - 管理者用ログイン： http://localhost/admin/login
  - phpMyAdmin:http://localhost:8080/
  - meilhog： http://localhost:8025/