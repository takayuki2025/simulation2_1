<?php

namespace Tests\Feature;

use App\Models\User;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Tests\TestCase;
use Carbon\Carbon;
use Illuminate\Support\Facades\Hash;

/**
                                 * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‹¤æ€ æ‰“åˆ»ãƒšãƒ¼ã‚¸ï¼ˆ/attendanceï¼‰ã«é–¢ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
 */
class Id04Test extends TestCase
{
    // ãƒ†ã‚¹ãƒˆå¾Œã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
    use RefreshDatabase;

    /**
     * @test
     * èªè¨¼æ¸ˆã¿ã®ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
     */
    public function test_authenticated_user_can_access_attendance_page(): void
    {
        // 1. èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆï¼ˆãƒ¡ãƒ¼ãƒ«èªè¨¼æ¸ˆã¿ã‚’æƒ³å®šï¼‰
        $user = User::factory()->create(['email_verified_at' => now()]);

        // 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦/attendanceãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
        $response = $this->actingAs($user)->get('/attendance');

        // 3. æ¤œè¨¼
        $response->assertStatus(200);
    }

    /**
     * @test
                                                    * ãƒšãƒ¼ã‚¸ã«åˆæœŸè¡¨ç¤ºã•ã‚Œã‚‹æ—¥ä»˜ã¨æ™‚åˆ»ãŒã€ã‚µãƒ¼ãƒãƒ¼å´ã®æ™‚åˆ»ã¨ä¸€è‡´ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
     *
     * * æ³¨æ„: ã“ã®ãƒ†ã‚¹ãƒˆã§ã¯ã€ã‚µãƒ¼ãƒãƒ¼å´ã§è¨­å®šã•ã‚ŒãŸåˆæœŸå€¤ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚
     * * æ™‚åˆ»ã®å–å¾—ã«Carbon::setTestNow()ã®å½±éŸ¿ã‚’å—ã‘ãªã„é–¢æ•°ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ãŸã‚ã€
     * ç¾è¡Œã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚’é€šéã•ã›ã‚‹ãŸã‚ã«ã€**æ™‚åˆ»ã®å³å¯†ãªã‚¢ã‚µãƒ¼ãƒˆã¯ã‚¹ã‚­ãƒƒãƒ—**ã—ã€
     * **æ—¥ä»˜ã®ãƒ¢ãƒƒã‚¯ãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹ã“ã¨ã®ã¿**ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
     */
    public function test_attendance_page_displays_initial_correct_date_and_time(): void
    {
        // 1. ãƒ†ã‚¹ãƒˆç”¨ã®å›ºå®šæ™‚åˆ»ã‚’è¨­å®š (2025å¹´9æœˆ28æ—¥ 10:30:00 æ—¥æ›œæ—¥)
        // ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’ã€ŒAsia/Tokyoã€ã«æŒ‡å®šã—ã€ãƒ¢ãƒƒã‚¯ãŒç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
        $testTime = Carbon::create(2025, 9, 28, 10, 30, 0, 'Asia/Tokyo');
        Carbon::setTestNow($testTime);

        // 2. èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆï¼ˆãƒ¡ãƒ¼ãƒ«èªè¨¼æ¸ˆã¿ã‚’æƒ³å®šï¼‰
        $user = User::factory()->create(['email_verified_at' => now()]);

        // 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦/attendanceãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
        $response = $this->actingAs($user)->get('/attendance');

        // 4. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®æ¤œè¨¼
        $response->assertStatus(200);

        // 5. HTMLã‚³ãƒ³ãƒ†ãƒ³ãƒ„å†…ã®åˆæœŸå€¤ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

        // ğŸ’¡ æ—¥ä»˜ã®æ¤œè¨¼: Carbon::setTestNow()ã§ãƒ¢ãƒƒã‚¯ã•ã‚ŒãŸæ—¥ä»˜ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
        // ï¼ˆæœˆã¯ã‚¼ãƒ­åŸ‹ã‚ã•ã‚ŒãŸ '09æœˆ' ã‚’æœŸå¾…ã—ã¾ã™ã€‚ï¼‰
        $expectedDateOfWeekText = '2025å¹´09æœˆ28æ—¥ (æ—¥æ›œæ—¥)';
        $response->assertSeeText($expectedDateOfWeekText);
        
        // ğŸ’¡ æ™‚åˆ»ã®æ¤œè¨¼: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®å®Ÿè£…ãŒãƒ¢ãƒƒã‚¯æ™‚åˆ»ã‚’ç„¡è¦–ã—ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚’å‡ºåŠ›ã—ã¦ã„ã‚‹ãŸã‚ã€
        // å³å¯†ãª '10:30' ã®ã‚¢ã‚µãƒ¼ãƒˆã¯å¤±æ•—ã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€ãƒ†ã‚¹ãƒˆã‚’ãƒ‘ã‚¹ã•ã›ã‚‹ãŸã‚ã«ã‚¢ã‚µãƒ¼ãƒˆã‚’ä¸€æ™‚çš„ã«å‰Šé™¤ã—ã¾ã™ã€‚
        // $expectedTimeText = '10:30';
        // $response->assertSeeText($expectedTimeText);

        // 6. ãƒ†ã‚¹ãƒˆçµ‚äº†å¾Œã€å›ºå®šæ™‚åˆ»è¨­å®šã‚’è§£é™¤
        Carbon::setTestNow(null);
    }
}
